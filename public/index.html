<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Da Vinci - AI Email Sequence Creator</title>
        <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
                background: #f9fafb;
                height: 100vh;
            }
            #app {
                height: 100vh;
                max-width: 800px;
                margin: 0 auto;
                display: flex;
                flex-direction: column;
                background: white;
                box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            }
            header {
                padding: 24px;
                border-bottom: 1px solid #e5e7eb;
                background: white;
            }
            h1 {
                font-size: 24px;
                font-weight: 600;
                color: #111827;
                margin-bottom: 4px;
            }
            .subtitle {
                color: #6b7280;
                font-size: 14px;
            }
            .chat-container {
                flex: 1;
                display: flex;
                flex-direction: column;
                overflow: hidden;
            }
            .messages {
                flex: 1;
                overflow-y: auto;
                padding: 24px;
                background: #f9fafb;
            }
            .message {
                margin-bottom: 16px;
                display: flex;
                gap: 12px;
            }
            .message.user {
                flex-direction: row-reverse;
            }
            .bubble {
                max-width: 70%;
                padding: 12px 16px;
                border-radius: 18px;
                font-size: 15px;
                line-height: 1.4;
            }
            .bubble.user {
                background: #3b82f6;
                color: white;
                border-bottom-right-radius: 4px;
            }
            .bubble.ai {
                background: white;
                color: #111827;
                border: 1px solid #e5e7eb;
                border-bottom-left-radius: 4px;
            }
            .input-area {
                padding: 20px 24px;
                border-top: 1px solid #e5e7eb;
                background: white;
            }
            .input-group {
                display: flex;
                gap: 12px;
                align-items: end;
            }
            input[type="text"] {
                flex: 1;
                padding: 12px 16px;
                border: 1px solid #d1d5db;
                border-radius: 12px;
                font-size: 15px;
                outline: none;
            }
            input:focus {
                border-color: #3b82f6;
                box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            }
            button {
                padding: 12px 20px;
                background: #3b82f6;
                color: white;
                border: none;
                border-radius: 12px;
                font-weight: 500;
                cursor: pointer;
                transition: background 0.2s;
            }
            button:hover:not(:disabled) {
                background: #2563eb;
            }
            button:disabled {
                background: #9ca3af;
                cursor: not-allowed;
            }
            .knowledge {
                position: absolute;
                bottom: 80px;
                right: 24px;
                background: #dbeafe;
                color: #1e40af;
                padding: 4px 12px;
                border-radius: 20px;
                font-size: 12px;
                font-weight: 500;
            }
            .loading {
                display: inline-block;
                width: 12px;
                height: 12px;
                border: 2px solid #e5e7eb;
                border-top: 2px solid #3b82f6;
                border-radius: 50%;
                animation: spin 1s linear infinite;
            }
            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }
            .scrollbar::-webkit-scrollbar {
                width: 6px;
            }
            .scrollbar::-webkit-scrollbar-track {
                background: transparent;
            }
            .scrollbar::-webkit-scrollbar-thumb {
                background: #d1d5db;
                border-radius: 3px;
            }
        </style>
    </head>
    <body>
        <div id="app">
            <header>
                <h1>Da Vinci</h1>
                <p class="subtitle">AI Email Sequence Creator</p>
            </header>
            <div class="chat-container">
                <div class="messages scrollbar" ref="messages">
                    <div
                        v-for="(msg, index) in messages"
                        :key="index"
                        class="message"
                        :class="msg.role"
                    >
                        <div class="bubble" :class="msg.role">
                            {{ msg.content }}
                        </div>
                    </div>
                    <div v-if="isLoading" class="message ai">
                        <div class="bubble ai">
                            <span class="loading"></span> Da Vinci is
                            thinking...
                        </div>
                    </div>
                </div>
                <div v-if="knowledgeIndicator" class="knowledge">
                    {{ knowledgeIndicator }}
                </div>
                <div class="input-area">
                    <div class="input-group">
                        <input
                            v-model="input"
                            @keypress.enter="sendMessage"
                            placeholder="Describe your business or paste website URL..."
                            :disabled="isLoading"
                        />
                        <button
                            @click="sendMessage"
                            :disabled="!input || isLoading"
                        >
                            {{ isLoading ? '...' : 'Send' }}
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <script>
            const { createApp, ref, computed, onMounted, nextTick } = Vue;

            createApp({
                setup() {
                    const messages = ref([]);
                    const input = ref("");
                    const isLoading = ref(false);
                    const messagesEl = ref(null);

                    // Backend API base URL (update for production)
                    const API_BASE = "http://localhost:8080";

                    const knowledgeIndicator = computed(() => {
                        const lastMsg =
                            messages.value[messages.value.length - 1];
                        if (lastMsg?.vertical) {
                            return `Knowledge: ${lastMsg.vertical}`;
                        }
                        return "";
                    });

                    const sendMessage = async () => {
                        if (!input.value.trim() || isLoading.value) return;

                        const userMsg = input.value.trim();
                        messages.value.push({ role: "user", content: userMsg });
                        input.value = "";
                        isLoading.value = true;

                        // Scroll to bottom
                        await nextTick();
                        messagesEl.value.scrollTop =
                            messagesEl.value.scrollHeight;

                        try {
                            const response = await fetch(`${API_BASE}/chat`, {
                                method: "POST",
                                headers: { "Content-Type": "application/json" },
                                body: JSON.stringify({
                                    currentMessage: userMsg,
                                    conversationHistory:
                                        messages.value.slice(-10), // Last 10 messages
                                }),
                            });

                            const data = await response.json();
                            messages.value.push({
                                role: "ai",
                                content: data.message,
                                vertical: data.identifiedVertical,
                                step: data.workflowStep,
                            });
                        } catch (error) {
                            messages.value.push({
                                role: "ai",
                                content:
                                    "Sorry, having trouble connecting. Check backend at localhost:8080",
                            });
                        }

                        isLoading.value = false;
                        // Scroll to bottom
                        await nextTick();
                        messagesEl.value.scrollTop =
                            messagesEl.value.scrollHeight;
                    };

                    onMounted(() => {
                        // Welcome message
                        messages.value.push({
                            role: "ai",
                            content:
                                "Hi, I'm Da Vinci, The Automated Email Sequence Creator. Let me ask you a few questions to get started.",
                        });
                    });

                    return {
                        messages,
                        input,
                        isLoading,
                        messagesEl,
                        knowledgeIndicator,
                        sendMessage,
                    };
                },
            }).mount("#app");
        </script>
    </body>
</html>
